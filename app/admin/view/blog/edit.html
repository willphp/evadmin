<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改</title>
    <link href="__STATIC__/component/pear/css/pear.css" rel="stylesheet"/>
    <link href="__STATIC__/component/pear/css/willphp.css" rel="stylesheet"/>
    <script src="__STATIC__/component/layui/layui.js"></script>
    <script src="__STATIC__/component/pear/pear.js"></script>
</head>
<body>
<form class="layui-form" action="{:url('edit')}" method="post">
    <input type="hidden" name="id" value="{$vo.id}" />
    <div class="mainBox">
        <div class="main-container">
<!--表单生成开始-->
<div class="layui-form-item">
	<label class="layui-form-label">标题</label>
	<div class="layui-input-block"><input type="text" name="title" placeholder="请输入标题" value="{$vo.title}" lay-verify="required" class="layui-input"></div>
</div>
<div class="layui-form-item">
	<label class="layui-form-label">分类</label>
	<div class="layui-input-block">{:build_select('category_id', widget('form_tip')->get(13), $vo['category_id'])}</div>
</div>
<div class="layui-form-item">
	<label class="layui-form-label">封面</label>
	<div class="layui-input-block"><input type="hidden" id="thumb" name="thumb" value="{$vo.thumb}"><div class="upload-image layui-upload-drag" id="ID-upload-thumb-drag">{if empty($vo['thumb']):}<img id="thumb-preview" src="" style="display:none;" width="90" height="60">上传图片<span id="del_thumb" class="del_pic">删除</span>{else:}<img id="thumb-preview" src="{$vo.thumb}" width="90" height="60">上传图片<span id="del_thumb" class="del_pic" style="display:inline;">删除</span>{/if}</div>{:opt_photo('thumb')}</div>
</div>
<div class="layui-form-item">
	<label class="layui-form-label">标签</label>
	<div class="layui-input-block">{:build_select('tag_ids', widget('form_tip')->get(15), $vo['tag_ids'], ' xm-select="tag_ids"')}</div>
</div>
<div class="layui-form-item">
	<label class="layui-form-label">内容</label>
	<div class="layui-input-block"><textarea name="content" id="editor-content" placeholder="请输入内容" class="layui-textarea">{$vo.content}</textarea></div>
</div>
<div class="layui-form-item">
	<label class="layui-form-label">置顶</label>
	<div class="layui-input-block"><input type="checkbox" name="is_top" value="1" lay-skin="switch" lay-text="是|否"{if $vo['is_top']:} checked="checked"{/if}></div>
</div>
<div class="layui-form-item">
	<label class="layui-form-label">发布</label>
	<div class="layui-input-block"><input type="text" name="post_time" value="{:date('Y-m-d H:i:s', $vo['post_time'])}" class="layui-input" id="datetime-post_time" placeholder="yyyy-MM-dd HH:mm:ss"></div>
</div>
<!--表单生成结束-->
        </div>
    </div>
    <div class="bottom">
        <div class="button-container">
            <button type="submit" class="layui-btn layui-btn-normal layui-btn-sm" lay-submit="" lay-filter="save">
                <i class="layui-icon layui-icon-ok"></i>
                提交
            </button>
            <button type="reset" class="layui-btn layui-btn-primary layui-btn-sm">
                <i class="layui-icon layui-icon-refresh"></i>
                重置
            </button>
        </div>
    </div>
</form>
<script>
    let layui_module = ['form', 'jquery', 'willphp'];
    //加载模块
	layui_module.push('select');
	layui_module.push('tinymce');
    layui.use(layui_module, function () {
        let form = layui.form;
        let $ = layui.jquery;
        let willphp = layui.willphp;
        //表单JS设置
		layui.upload.render({elem:'#ID-upload-thumb-drag',url:"{:url('api/upload_image')}",done:function(res){if(res.status==1){del_pic();$('#thumb').val(res.data.path);$('#thumb-preview').attr('src',res.data.path).show();$('#del_thumb').show()}}});
		$('#del_thumb').on('click',function(e){del_pic();$('#thumb').val('');$('#thumb-preview').attr('src','').hide();$('#del_thumb').hide();layui.stope(e)});
		function del_pic(){let pic=$('#thumb-preview').attr('src');$('#thumb').val('');if(pic.trim().length!==0){ $.post("{:url('api/image_del')}",{pic:pic},function(ret){},'json') }}
		let editor = layui.tinymce.render({elem:'#editor-content',height:400,images_upload_handler:(blobInfo,success,failure)=>{let formData=new FormData();formData.append('file',blobInfo.blob(),blobInfo.filename());$.ajax({url:"{:url('api/upload_image')}",data:formData,type:'post',contentType:false,processData:false,success:function(res){if(res.status===1){success(res.data.path)}else{failure(res.msg)}}})}});
		layui.laydate.render({ elem: '#datetime-post_time', type: 'datetime'});
        form.on('submit(save)', function (data) {
            //表单提交数据设置
			data.field.content = editor.getContent();
            willphp.ajaxPost(data, 0, function () {
                parent.layer.close(parent.layer.getFrameIndex(window.name));
                parent.layui.table.reload('dataTable');
            });
            return false;
        });
    })
</script>
</body>
</html>